####################################################################
# WARNING: These are designed specifically for Ansible tests       #
# and should not be used as examples of how to write Ansible roles #
####################################################################

- name: Create a test dabase
  community.clickhouse.clickhouse_client:
    execute: CREATE DATABASE IF NOT EXISTS foo

- name: Create a test table
  register: result
  community.clickhouse.clickhouse_client:
    login_host: localhost
    client_kwargs:
      connect_timeout: 20
    execute: >
      CREATE TABLE IF NOT EXISTS foo.test_table1
      (x String) ENGINE = Memory
    execute_kwargs:
      types_check: false

- name: Insert into test table using named args
  register: result
  community.clickhouse.clickhouse_client:
    execute: "INSERT INTO foo.test_table1 (x) VALUES (%(a)s), (%(b)s), (%(c)s)"
    execute_kwargs:
      params:
        a: one
        b: two
        c: three

- name: Create a test user
  community.clickhouse.clickhouse_user:
    state: present
    name: alice
    password: querty

- name: Check the user exists
  register: result
  community.clickhouse.clickhouse_info:
    login_host: localhost
    client_kwargs:
      connect_timeout: 20

- name: Check user's attributes
  ansible.builtin.assert:
    that:
    - result["users"]["alice"] != {}
